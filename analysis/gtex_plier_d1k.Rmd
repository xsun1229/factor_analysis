---
title: "PLIER analysis summary for GTEx Whole blood data"
author: "XSun"
date: "2021-06-24"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

## **Introduction**

We used the [PLIER R package](https://github.com/wgmao/PLIER) with the collection of 12999 gene sets as a prior information matrix priorMat available in the package comprising canonical, immune and chemgen pathways from MSigDB (same with the eLife paper)

We used 26 immune and blood cell traits in this part, they are: "mch","mchc","mcv","rdw","ret","baso","plt","pct","pdw","mpv","hct","hgb","ret","mono","T1D", "EUR.IBD","EUR.UC","EUR.CD","ukb.allasthma","eo","wbc","rbc","myeloid_wbc","gran","lymph","neut","allergy"

We got 98 LVs. 

## **Enrichment results**

We have 2548 trait-factor pairs in total. 31 pairs have more than 2 SNPs with FDR <0.2.

<figure class="half">
    <img src="https://github.com/xsun1229/factor_analysis/raw/master/output/snp_count_wb_gtex_98lvs.jpeg" width="80%">
</figure>

There are 4 pairs show sign consistency (have p-values < 0.05 in resampling, 2.58 fold enrichment). There are 1 pairs at p-value < 0.01, 3.23 fold enrichment). 

<figure class="half">
    <img src="https://github.com/xsun1229/factor_analysis/raw/master/output/effectsizesum_plier_gtex_98lv.jpeg" width="80%">
</figure>


```{r echo=FALSE}
sum <- read.table("/project2/xinhe/xsun/website/factor_analysis/output/simple_sum_d1k_plier_wb_98lvs.txt", header = T)
DT::datatable(sum, options = list(pageLength =5))
```


## **Reverse causality checking** 

For the pairs have p-value < 0.05 in resampling, we checked the effect size correlation could be due to reverse causality.

We first used all SNPs associated with traits(pval<5E-8). We computed the MBE estimator and the p-values of the estimator. When computing the IVW, we exchanged the beta.outcome and beta.exposure.

Then we removed the SNPs have FDR < 0.2, just used the remaining SNP to compute IVW and do the fitting.

**The suffix "_reverse" are the results for traits -> LV (using all candidate SNPs after LD Clumping), the suffix "_rremove" are the results for traits -> LV (using all candidate SNPs after LD Clumping but remove the SNPs have fdr < 0.2)**

```{r echo=FALSE}
load("/project2/xinhe/xsun/website/factor_analysis/output/reverse_check_plier_wb_mbe_98lvs.rdata")
DT::datatable(sum, options = list(pageLength =5))
```

## **SNP details**

```{r echo=FALSE}
load("/project2/xinhe/xsun/website/factor_analysis/output/info_table_annot_d1k_plier_wb_98lvs.rdata")
DT::datatable(final_full, options = list(pageLength =5))
```


## **Effectsize plots**

<figure class="half">
    <img src="https://github.com/xsun1229/factor_analysis/raw/master/output/effectsize_plier_gtex.jpg" width="100%">
</figure>

## **Colocalization results**

For the SNPs above, we did colocalization analysis.

The method for colocalization analysis were described in [3.3](https://xsun1229.github.io/factor_analysis/factors_traits.html#33_colocalization_analysis)

### +-250kb from the target locus

```{r echo=FALSE}
load("/project2/xinhe/xsun/website/factor_analysis/output/coloc_sum_500kb_gtex_plier.rdata")
DT::datatable(summary, options = list(pageLength =5))
```

Two plots for the locus has the highest PP4: 

**ret_lv73_rs2523990**

<figure class="half">
    <img src="https://github.com/xsun1229/factor_analysis/raw/master/output/ret_lv73_chr6_30109452_A_G_b38_rs2523990_500.coloc.jpeg" width="80%">
</figure>


**ret_lv73_rs10067881**

<figure class="half">
    <img src="https://github.com/xsun1229/factor_analysis/raw/master/output/ret_lv73_chr5_95826771_G_A_b38_rs10067881_500.coloc.jpeg" width="80%">
</figure>

### +-500kb from the target locus

```{r echo=FALSE}
load("/project2/xinhe/xsun/website/factor_analysis/output/coloc_sum_1000kb_gtex_plier.rdata")
DT::datatable(summary, options = list(pageLength =5))
```

Plots for the locus has the highest PP4: 

**ret_lv73_rs2523990**

<figure class="half">
    <img src="https://github.com/xsun1229/factor_analysis/raw/master/output/ret_lv73_chr6_30109452_A_G_b38_rs2523990_1000.coloc.jpeg" width="80%">
</figure>


**ret_lv73_rs10067881**

<figure class="half">
    <img src="https://github.com/xsun1229/factor_analysis/raw/master/output/ret_lv73_chr5_95826771_G_A_b38_rs10067881_1000.coloc.jpeg" width="80%">
</figure>


## **ORA Enrichment results**

The method for ORA were described in [3.4](https://xsun1229.github.io/factor_analysis/factors_traits.html#34_ora_enrichment_analysis)

### EUR.UC_wb_lv46

#### ALL genes have non-zero loadings

```{r echo=FALSE}
load("/project2/xinhe/xsun/website/factor_analysis/output/lv46_plier_wb_all_98lvs.rdata")
DT::datatable(ORA_results, options = list(pageLength =5))
```

#### Top 25% genes 

```{r echo=FALSE}
load("/project2/xinhe/xsun/website/factor_analysis/output/lv46_plier_wb_top025_98lvs.rdata")
DT::datatable(ORA_results, options = list(pageLength =5))
```


### rbc_wb_lv32

#### ALL genes have non-zero loadings

```{r echo=FALSE}
load("/project2/xinhe/xsun/website/factor_analysis/output/lv32_plier_wb_all_98lvs.rdata")
DT::datatable(ORA_results, options = list(pageLength =5))
```

#### Top 25% genes 

```{r echo=FALSE}
load("/project2/xinhe/xsun/website/factor_analysis/output/lv32_plier_wb_top025_98lvs.rdata")
DT::datatable(ORA_results, options = list(pageLength =5))
```


### ret_wb_lv73

#### ALL genes have non-zero loadings

```{r echo=FALSE}
load("/project2/xinhe/xsun/website/factor_analysis/output/lv73_plier_wb_all_98lvs.rdata")
DT::datatable(ORA_results, options = list(pageLength =5))
```

#### Top 25% genes 

```{r echo=FALSE}
load("/project2/xinhe/xsun/website/factor_analysis/output/lv73_plier_wb_top025_98lvs.rdata")
DT::datatable(ORA_results, options = list(pageLength =5))
```

### ukb.allasthma_wb_lv35

#### ALL genes have non-zero loadings

```{r echo=FALSE}
load("/project2/xinhe/xsun/website/factor_analysis/output/lv35_plier_wb_all_98lvs.rdata")
DT::datatable(ORA_results, options = list(pageLength =5))
```

#### Top 25% genes 

```{r echo=FALSE}
load("/project2/xinhe/xsun/website/factor_analysis/output/lv35_plier_wb_top025_98lvs.rdata")
DT::datatable(ORA_results, options = list(pageLength =5))
```